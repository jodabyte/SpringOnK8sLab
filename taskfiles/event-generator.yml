version: "3"

vars:
  K8S_DIR: "./k8s/Event-Generator"
  PROJECT_DIR: "./event-generator"

tasks:
  port-forward:
    cmds:
      - kubectl port-forward svc/event-generator 8082:8082 -n {{.NAMESPACE}}
  create-config:
    dir: "{{.K8S_DIR}}"
    cmds:
      - kubectl apply -f ConfigMap.yml
  deploy-app:
    dir: "{{.K8S_DIR}}"
    cmds:
      - kubectl apply -f Deployment.yml
  delete-app:
    dir: "{{.K8S_DIR}}"
    cmds:
      - kubectl delete -f Deployment.yml
  build-image:
    dir: "{{.PROJECT_DIR}}/"
    cmds:
      - eval $(minikube -p minikube docker-env) && ./mvnw spring-boot:build-image
  delete-build-deploy:
    cmds:
      - task: delete-app
      - task: build-image
      - task: deploy-app
